version: "3.9"
services:
  backend:
    build: .
    depends_on:
      mysql:
        condition: service_started
    env_file:
      - .env
    environment:
      - APP_DEBUG
      - APP_LOG_SQL
      - APP_PORT=8001
      - APP_HOST
      - APP_KEY
      - APP_VERSION
      - SESSION_COOKIE_NAME
      - FILE_STORAGE_LOCATION
      - FILE_TMP_LOCATION
      - VATSIM_API_BASE
      - VATGER_API_BASE
      - MOODLE_API_BASE
      - CONNECT_BASE
      - CONNECT_REDIRECT_URI
      - CONNECT_SCOPE
      - CONNECT_CLIENT_ID
      - CONNECT_SECRET
      - DB_DIALECT
      - DB_HOST
      - DB_PORT
      - DB_DATABASE_NAME
      - DB_USERNAME
      - DB_PASSWORD
    ports:
      - "8001:8001"

  mysql:
    image: mysql
    restart: always
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: example
      MYSQL_USER: trainingcenter
      MYSQL_PASSWORD: example
      MYSQL_DATABASE: trainingcenter
    volumes:
      - trainingcenter-sql:/var/lib/mysql

volumes:
  trainingcenter-sql: